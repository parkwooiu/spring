<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.zerock.mapper.LiveChatMapper">

    <!-- 라이브 채팅 조회 쿼리 -->
    <select id="getLiveChat" resultType="org.zerock.domain.LiveChatVO">
        SELECT Users.UserID, Products.ProductID, Products.ProductName, Users.Username, LiveChat.Message, LiveChat.ChatTime
        FROM LiveChat
        JOIN Users ON LiveChat.UserID = Users.UserID
        JOIN Products ON Products.ProductID = LiveChat.ProductID
        WHERE LiveChat.UserID = #{userID} AND Products.ProductID = #{productID}
    </select>
    
    <!-- 특정 상품에 대한 채팅 기록을 가져오는 쿼리 -->
    <select id="getChatHistoryByProductID" resultType="org.zerock.domain.LiveChatVO">
        SELECT * FROM LiveChat WHERE ProductID = #{productID}
    </select>
    
    <!-- 메시지 삽입 쿼리 -->
    <insert id="insertMessage" parameterType="org.zerock.domain.LiveChatVO">
        INSERT INTO LiveChat (UserID, ProductID, Username, Message, ChatTime)
        VALUES (#{userID}, #{productID}, #{username}, #{message}, #{chatTime})
    </insert>

    <!-- 모든 라이브 채팅 조회 쿼리 -->
    <select id="getAllLiveChats" resultType="org.zerock.domain.LiveChatVO">
        SELECT Users.UserID, Products.ProductID, Products.ProductName, Users.Username, LiveChat.Message, LiveChat.ChatTime
        FROM LiveChat
        JOIN Users ON LiveChat.UserID = Users.UserID
        JOIN Products ON Products.ProductID = LiveChat.ProductID
    </select>

    <!-- 사용자 ID를 기준으로 채팅 기록을 조회하는 쿼리 -->
    <select id="getChatHistoryByUserID" resultType="org.zerock.domain.LiveChatVO" parameterType="int">
        SELECT Users.UserID, Products.ProductID, Products.ProductName, Users.Username, LiveChat.Message, LiveChat.ChatTime
        FROM LiveChat
        JOIN Users ON LiveChat.UserID = Users.UserID
        JOIN Products ON Products.ProductID = LiveChat.ProductID
        WHERE Users.UserID = #{userID}
    </select>

    <!-- 라이브 채팅 삽입 쿼리 -->
    <insert id="insertLiveChat" parameterType="org.zerock.domain.LiveChatVO">
        INSERT INTO LiveChat (UserID, ProductID, Message, ChatTime)
        VALUES (#{userID}, #{productID}, #{message}, #{chatTime})
    </insert>

    <!-- 라이브 채팅 업데이트 쿼리 -->
    <update id="updateLiveChat" parameterType="org.zerock.domain.LiveChatVO">
        UPDATE LiveChat
        SET Message = #{message}, ChatTime = #{chatTime}
        WHERE UserID = #{userID} AND ProductID = #{productID}
    </update>

    <!-- 라이브 채팅 삭제 쿼리 -->
    <delete id="deleteLiveChat">
        DELETE FROM LiveChat WHERE UserID = #{userID} AND ProductID = #{productID}
    </delete>

    <!-- 모든 라이브 채팅 레코드 조회 쿼리 -->
    <select id="getChatRecords" resultType="org.zerock.domain.LiveChatVO">
        SELECT Users.UserID, Products.ProductID, Products.ProductName, Users.Username, LiveChat.Message, LiveChat.ChatTime
        FROM LiveChat
        JOIN Users ON LiveChat.UserID = Users.UserID
        JOIN Products ON Products.ProductID = LiveChat.ProductID
    </select>
    
    <!-- 사용자 아이디로부터 사용자 이름 조회 쿼리 -->
    <select id="getUsernameByUserId" resultType="string">
        SELECT Username
        FROM Users
        WHERE UserID = #{userID}
    </select>

</mapper>
